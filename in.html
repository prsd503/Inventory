<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Product Inventory</title>
<style>
  :root {
    --color-kitchen: #f9a825;
    --color-medicine: #1e88e5;
    --color-bg: #f0f4f8;
    --color-dark: #333;
    --color-light: #fff;
    --color-accent: #e53935;
    --color-accent-light: #ff7961;
    --modal-bg: rgba(0,0,0,0.6);
    --modal-content-bg: #fff;
  }
  body {
    margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: var(--color-bg);
    color: var(--color-dark);
    display: flex; flex-direction: column; height: 100vh;
  }
  header {
    background: var(--color-dark);
    color: var(--color-light);
    padding: 12px 16px;
    text-align: center;
    font-weight: bold;
    font-size: 1.4rem;
  }
  .tabs {
    display: flex;
    background: var(--color-bg);
    border-bottom: 3px solid var(--color-dark);
  }
  .tab-btn {
    flex: 1;
    border: none;
    background: var(--color-bg);
    padding: 14px 0;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s ease;
    color: var(--color-dark);
  }
  .tab-btn.active {
    background: var(--color-kitchen);
    color: var(--color-light);
  }
  .tab-btn[data-for="medicine"].active {
    background: var(--color-medicine);
  }
  main {
    flex: 1;
    overflow-y: auto;
    padding: 16px;
  }
  .page {
    display: none;
  }
  .page.active {
    display: block;
  }

  /* Form styles */
  form {
    background: var(--color-light);
    padding: 12px;
    border-radius: 8px;
    box-shadow: 0 3px 7px rgb(0 0 0 / 0.1);
    margin-bottom: 16px;
  }
  form > * {
    margin-bottom: 12px;
  }
  label {
    font-weight: 600;
    display: block;
    margin-bottom: 4px;
  }
  input[type=text], input[type=number], input[type=date] {
    width: 100%;
    padding: 8px;
    box-sizing: border-box;
    border: 2px solid var(--color-kitchen);
    border-radius: 6px;
    font-size: 1rem;
    transition: border-color 0.3s ease;
  }
  input[type=text]:focus, input[type=number]:focus, input[type=date]:focus {
    border-color: var(--color-medicine);
    outline: none;
  }
  button {
    padding: 12px;
    font-size: 1rem;
    font-weight: 700;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    width: 100%;
    box-sizing: border-box;
  }
  button.save-btn {
    background-color: var(--color-kitchen);
    color: white;
  }
  button.save-btn:hover {
    background-color: #c17900;
  }
  button.cancel-btn {
    background-color: var(--color-accent-light);
    color: white;
    margin-top: -8px;
  }
  button.cancel-btn:hover {
    background-color: var(--color-accent);
  }

  /* Search input */
  .search-input {
    width: 100%;
    padding: 8px 12px;
    margin-bottom: 12px;
    font-size: 1rem;
    border: 2px solid var(--color-medicine);
    border-radius: 6px;
  }

  /* Table for desktop */
  table {
    width: 100%;
    border-collapse: collapse;
    background: var(--color-light);
    border-radius: 8px;
    overflow: hidden;
  }
  th, td {
    padding: 8px 10px;
    text-align: left;
    border-bottom: 1px solid #ddd;
    font-size: 0.9rem;
  }
  th {
    background: var(--color-kitchen);
    color: white;
  }
  .tab-btn[data-for="medicine"].active ~ main table th {
    background: var(--color-medicine);
  }
  tr:nth-child(even) {
    background: #fafafa;
  }
  .action-btn {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 1.1rem;
    margin-right: 8px;
    color: var(--color-medicine);
    transition: color 0.3s ease;
  }
  .action-btn.delete {
    color: var(--color-accent);
  }
  .action-btn:hover {
    opacity: 0.7;
  }

  /* Responsive: block cards instead of table on small screens */
  @media (max-width: 700px) {
    table, thead, tbody, th, td, tr {
      display: block;
      width: 100%;
    }
    thead tr {
      display: none;
    }
    tbody tr {
      margin-bottom: 16px;
      border-radius: 8px;
      box-shadow: 0 3px 7px rgb(0 0 0 / 0.1);
      padding: 12px;
      position: relative;
      transition: background-color 0.3s ease;
    }
    tbody tr:nth-child(even) {
      background: var(--color-light);
    }
    td {
      position: relative;
      padding-left: 50%;
      border: none;
      border-bottom: 1px solid #eee;
      font-size: 0.9rem;
    }
    td:last-child {
      border-bottom: none;
      padding-left: 0;
      text-align: right;
    }
    td:before {
      position: absolute;
      top: 12px;
      left: 12px;
      width: 45%;
      padding-right: 10px;
      white-space: nowrap;
      font-weight: 600;
      color: var(--color-dark);
      content: attr(data-label);
      font-size: 0.9rem;
    }
    .action-btn {
      font-size: 1.3rem;
      margin: 0 4px;
    }

    /* Expiry status colors for cards */
    tbody tr.expired {
      background-color: #f44336 !important; /* Red */
      color: white;
      box-shadow: 0 3px 7px rgb(244 67 54 / 0.7);
    }
    tbody tr.expiring {
      background-color: #ffeb3b !important; /* Yellow */
      color: #333;
      box-shadow: 0 3px 7px rgb(255 235 59 / 0.7);
    }
    tbody tr.not-expired {
      background-color: #4caf50 !important; /* Green */
      color: white;
      box-shadow: 0 3px 7px rgb(76 175 80 / 0.7);
    }
  }

  /* Modal overlay & content */
  .modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0; top: 0; right: 0; bottom: 0;
    background: var(--modal-bg);
    backdrop-filter: blur(2px);
    align-items: center;
    justify-content: center;
  }
  .modal.active {
    display: flex;
  }
  .modal-content {
    background: var(--modal-content-bg);
    padding: 24px 32px;
    border-radius: 10px;
    box-shadow: 0 10px 25px rgb(0 0 0 / 0.2);
    max-width: 90vw;
    max-height: 90vh;
    overflow-y: auto;
    text-align: center;
  }
  .modal-content p {
    font-size: 1.1rem;
    margin-bottom: 20px;
  }
  .modal-buttons {
    display: flex;
    justify-content: center;
    gap: 20px;
  }
  .modal-buttons button {
    padding: 10px 24px;
    font-size: 1rem;
    font-weight: 600;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    min-width: 100px;
  }
  .btn-confirm {
    background-color: var(--color-kitchen);
    color: white;
    transition: background-color 0.3s ease;
  }
  .btn-confirm:hover {
    background-color: #c17900;
  }
  .btn-cancel {
    background-color: var(--color-accent-light);
    color: white;
  }
  .btn-cancel:hover {
    background-color: var(--color-accent);
  }
</style>
</head>
<body>
<header>Product Inventory</header>
<div class="tabs" role="tablist">
  <button class="tab-btn active" data-for="kitchen" role="tab" aria-selected="true" aria-controls="kitchen" tabindex="0">Kitchen</button>
  <button class="tab-btn" data-for="medicine" role="tab" aria-selected="false" aria-controls="medicine" tabindex="-1">Medicine</button>
</div>
<main>
  <!-- Kitchen Inventory -->
  <section id="kitchen" class="page active" aria-label="Kitchen Inventory Page" role="tabpanel" tabindex="0">
    <form id="kitchen-form" aria-label="Add or Edit Kitchen Inventory Item">
      <input type="hidden" id="kitchen-edit-id" />
      <label for="kitchen-product">Product</label>
      <input type="text" id="kitchen-product" required placeholder="Enter product name" />
      <label for="kitchen-quantity">Quantity</label>
      <input type="number" id="kitchen-quantity" min="1" required placeholder="Enter quantity" />
      <label for="kitchen-packing">Packing</label>
      <input type="text" id="kitchen-packing" placeholder="e.g., 1 kg bag" />
      <label for="kitchen-location">Location</label>
      <input type="text" id="kitchen-location" placeholder="Where stored" />
      <label for="kitchen-purchase-date">Purchase Date</label>
      <input type="date" id="kitchen-purchase-date" />
      <label for="kitchen-expiry-date">Expiry Date</label>
      <input type="date" id="kitchen-expiry-date" />
      <button type="submit" class="save-btn">Save Item</button>
      <button type="button" class="cancel-btn" onclick="clearForm('kitchen')">Cancel</button>
    </form>
    <input type="search" id="search-kitchen" class="search-input" placeholder="Search kitchen inventory..." aria-label="Search kitchen inventory" />
    <table id="kitchen-table" aria-label="Kitchen inventory table">
      <thead>
        <tr>
          <th scope="col">Product</th>
          <th scope="col">Qty</th>
          <th scope="col">Packing</th>
          <th scope="col">Location</th>
          <th scope="col">Purchase Date</th>
          <th scope="col">Expiry Date</th>
          <th scope="col">Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Medicine Inventory -->
  <section id="medicine" class="page" aria-label="Medicine Inventory Page" role="tabpanel" tabindex="0">
    <form id="medicine-form" aria-label="Add or Edit Medicine Inventory Item">
      <input type="hidden" id="medicine-edit-id" />
      <label for="medicine-product">Product</label>
      <input type="text" id="medicine-product" required placeholder="Enter product name" />
      <label for="medicine-quantity">Quantity</label>
      <input type="number" id="medicine-quantity" min="1" required placeholder="Enter quantity" />
      <label for="medicine-packing">Packing</label>
      <input type="text" id="medicine-packing" placeholder="e.g., 1 box" />
      <label for="medicine-location">Location</label>
      <input type="text" id="medicine-location" placeholder="Where stored" />
      <label for="medicine-purchase-date">Purchase Date</label>
      <input type="date" id="medicine-purchase-date" />
      <label for="medicine-expiry-date">Expiry Date</label>
      <input type="date" id="medicine-expiry-date" />
      <button type="submit" class="save-btn">Save Item</button>
      <button type="button" class="cancel-btn" onclick="clearForm('medicine')">Cancel</button>
    </form>
    <input type="search" id="search-medicine" class="search-input" placeholder="Search medicine inventory..." aria-label="Search medicine inventory" />
    <table id="medicine-table" aria-label="Medicine inventory table">
      <thead>
        <tr>
          <th scope="col">Product</th>
          <th scope="col">Qty</th>
          <th scope="col">Packing</th>
          <th scope="col">Location</th>
          <th scope="col">Purchase Date</th>
          <th scope="col">Expiry Date</th>
          <th scope="col">Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>
</main>

<!-- Modal Overlay for Confirmations and Alerts -->
<div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-desc">
  <div class="modal-content">
    <p id="modal-desc">Message</p>
    <div class="modal-buttons">
      <button id="modal-confirm" class="btn-confirm">Confirm</button>
      <button id="modal-cancel" class="btn-cancel">Cancel</button>
    </div>
  </div>
</div>

<script>
  // Manage tabs switching with accessibility
  const tabs = document.querySelectorAll('.tab-btn');
  const pages = document.querySelectorAll('.page');

  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      if (tab.classList.contains('active')) return;
      tabs.forEach(t => {
        t.classList.remove('active');
        t.setAttribute('aria-selected', 'false');
        t.setAttribute('tabindex', '-1');
      });
      tab.classList.add('active');
      tab.setAttribute('aria-selected', 'true');
      tab.setAttribute('tabindex', '0');
      const target = tab.getAttribute('data-for');
      pages.forEach(page => {
        const active = page.id === target;
        page.classList.toggle('active', active);
        page.setAttribute('tabindex', active ? '0' : '-1');
      });
      clearForm(target);
      document.getElementById('search-' + target).value = '';
      renderTable(target);
      tab.focus();
    });
  });

  const STORAGE_KEYS = {
    kitchen: 'inventory_kitchen',
    medicine: 'inventory_medicine'
  };

  let inventoryData = {
    kitchen: JSON.parse(localStorage.getItem(STORAGE_KEYS.kitchen) || '[]'),
    medicine: JSON.parse(localStorage.getItem(STORAGE_KEYS.medicine) || '[]'),
  };

  function saveData(type) {
    localStorage.setItem(STORAGE_KEYS[type], JSON.stringify(inventoryData[type]));
  }

  // Escape HTML utility
  function escapeHtml(text) {
    if (!text) return '';
    return text.replace(/[&<>"']/g, function(m) {
      return {
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#39;'
      }[m];
    });
  }

  function clearForm(section) {
    const form = document.getElementById(`${section}-form`);
    form.reset();
    form.querySelector(`#${section}-edit-id`).value = '';
  }

  function handleFormSubmit(event, section) {
    event.preventDefault();
    const form = event.target;
    const idField = form.querySelector(`#${section}-edit-id`);
    const editId = idField.value;

    const item = {
      id: editId || Date.now().toString(),
      product: form.querySelector(`#${section}-product`).value.trim(),
      quantity: parseInt(form.querySelector(`#${section}-quantity`).value),
      packing: form.querySelector(`#${section}-packing`).value.trim(),
      location: form.querySelector(`#${section}-location`).value.trim(),
      purchaseDate: form.querySelector(`#${section}-purchase-date`).value,
      expiryDate: form.querySelector(`#${section}-expiry-date`).value
    };

    if (!item.product) {
      showModal("Product name is required", false);
      return;
    }
    if (isNaN(item.quantity) || item.quantity < 1) {
      showModal("Quantity must be 1 or more", false);
      return;
    }

    if (editId) {
      const index = inventoryData[section].findIndex(i => i.id === editId);
      if (index > -1) {
        inventoryData[section][index] = item;
      }
    } else {
      inventoryData[section].push(item);
    }
    saveData(section);
    clearForm(section);
    renderTable(section);
  }

  function renderTable(section) {
    const tbody = document.querySelector(`#${section}-table tbody`);
    const searchTerm = document.getElementById(`search-${section}`).value.trim().toLowerCase();
    const today = new Date();
    const rows = inventoryData[section]
      .filter(item => item.product.toLowerCase().includes(searchTerm))
      .map(item => {
        const pd = item.purchaseDate || '';
        const ed = item.expiryDate || '';
        let expiryClass = 'not-expired'; // default green
        if (ed) {
          const expiryDate = new Date(ed + 'T23:59:59'); // end of expiry day
          const diff = (expiryDate - today) / (1000 * 60 * 60 * 24); // diff in days
          if (diff < 0) {
            expiryClass = 'expired'; // red
          } else if (diff <= 7) {
            expiryClass = 'expiring'; // yellow
          }
        }
        return `
        <tr class="${expiryClass}">
          <td data-label="Product">${escapeHtml(item.product)}</td>
          <td data-label="Qty">${item.quantity}</td>
          <td data-label="Packing">${escapeHtml(item.packing)}</td>
          <td data-label="Location">${escapeHtml(item.location)}</td>
          <td data-label="Purchase Date">${pd}</td>
          <td data-label="Expiry Date">${ed}</td>
          <td data-label="Actions">
            <button class="action-btn edit" onclick="editItem('${section}','${item.id}')" title="Edit" aria-label="Edit ${escapeHtml(item.product)}">&#9998;</button>
            <button class="action-btn delete" onclick="confirmDelete('${section}','${item.id}','${escapeHtml(item.product)}')" title="Delete" aria-label="Delete ${escapeHtml(item.product)}">&#10060;</button>
          </td>
        </tr>`;
      });
    tbody.innerHTML = rows.join('') || '<tr><td colspan="7" style="text-align:center;color:#888;">No items found</td></tr>';
  }

  function editItem(section, id) {
    const item = inventoryData[section].find(i => i.id === id);
    if (!item) {
      showModal('Item not found', false);
      return;
    }
    const form = document.getElementById(`${section}-form`);
    form.querySelector(`#${section}-edit-id`).value = item.id;
    form.querySelector(`#${section}-product`).value = item.product;
    form.querySelector(`#${section}-quantity`).value = item.quantity;
    form.querySelector(`#${section}-packing`).value = item.packing;
    form.querySelector(`#${section}-location`).value = item.location;
    form.querySelector(`#${section}-purchase-date`).value = item.purchaseDate;
    form.querySelector(`#${section}-expiry-date`).value = item.expiryDate;
    form.scrollIntoView({behavior: 'smooth'});
  }

  // Modal handling
  const modal = document.getElementById('modal');
  const modalDesc = document.getElementById('modal-desc');
  const btnConfirm = document.getElementById('modal-confirm');
  const btnCancel = document.getElementById('modal-cancel');
  let modalConfirmCallback = null;

  function showModal(message, confirmNeeded = true, confirmCallback = null) {
    modalDesc.textContent = message;
    modal.classList.add('active');
    btnConfirm.style.display = confirmNeeded ? 'inline-block' : 'none';
    modalConfirmCallback = confirmCallback;
    if (!confirmNeeded) {
      // Auto close after 2 seconds if just alert
      setTimeout(() => {
        closeModal();
      }, 2000);
    }
    btnConfirm.focus();
  }

  function closeModal() {
    modal.classList.remove('active');
    modalConfirmCallback = null;
  }

  btnConfirm.addEventListener('click', () => {
    if (typeof modalConfirmCallback === 'function') {
      modalConfirmCallback();
    }
    closeModal();
  });

  btnCancel.addEventListener('click', () => {
    closeModal();
  });

  function confirmDelete(section, id, product) {
    showModal(`Are you sure you want to delete "${product}"?`, true, () => {
      inventoryData[section] = inventoryData[section].filter(i => i.id !== id);
      saveData(section);
      renderTable(section);
    });
  }

  // Search handlers
  document.getElementById('search-kitchen').addEventListener('input', () => renderTable('kitchen'));
  document.getElementById('search-medicine').addEventListener('input', () => renderTable('medicine'));

  document.getElementById('kitchen-form').addEventListener('submit', e => handleFormSubmit(e, 'kitchen'));
  document.getElementById('medicine-form').addEventListener('submit', e => handleFormSubmit(e, 'medicine'));

  // Initial render
  renderTable('kitchen');
  renderTable('medicine');
</script>
</body>
</html>
